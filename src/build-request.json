{
  "kind": "build_request",
  "title": "Fix black screen on load after Version 47 deployment",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-5",
      "text": "Identify and fix the cause of the production black screen so the app reliably renders the initial UI instead of staying blank.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "It's loading up to a black screen"
        ]
      },
      "acceptanceCriteria": [
        "Loading the deployed app shows the normal UI (Hero / initialization screen) instead of a blank black screen.",
        "The browser console no longer shows a fatal startup exception that prevents React from mounting.",
        "If an unexpected runtime error occurs, the app displays an error fallback UI (not a blank screen)."
      ]
    },
    {
      "id": "REQ-6",
      "text": "Prevent runtime crashes caused by `process.env` usage in the frontend by adding a safe `process.env` polyfill before the React bundle executes (without modifying any files under frontend/src/hooks/useInternetIdentity.ts).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "It's loading up to a black screen"
        ]
      },
      "acceptanceCriteria": [
        "On a fresh page load, the app does not throw `ReferenceError: process is not defined`.",
        "`process.env.II_URL` is defined at runtime (via the polyfill) so Internet Identity login can initialize without crashing.",
        "`process.env.NODE_ENV` is defined at runtime (via the polyfill) so environment checks do not crash the app."
      ]
    },
    {
      "id": "REQ-7",
      "text": "Remove remaining unsafe references to `process.env.NODE_ENV` from editable React source (e.g., frontend/src/App.tsx) by switching to a Vite-compatible environment check so the app does not depend on the `process` global.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "It's loading up to a black screen"
        ]
      },
      "acceptanceCriteria": [
        "The frontend codebase no longer relies on `process.env.NODE_ENV` in editable files (e.g., App.tsx).",
        "The app builds and runs in production without requiring Node-style `process` globals beyond the REQ-6 polyfill (which exists to support immutable hook code)."
      ]
    }
  ],
  "constraints": [
    "Do not edit immutable frontend paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui.",
    "Backend must remain a single Motoko actor (no additional backend services).",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Adding new product features beyond fixing the black screen issue.",
    "Changing authentication providers (Internet Identity remains the only auth)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}